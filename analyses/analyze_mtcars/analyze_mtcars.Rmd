---
title: "Analyzing the mtcars dataset"
author: "Foo Bar"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
    html_document:
        code_folding: hide
        theme: flatly
        toc: true
        toc_float:
            collapsed: false
            smooth_scroll: false
---

```{r setup, include=FALSE}
# Set the working directory as the R project root
# You don't have to do this, but I find it is very convenient to 
# make all file paths relative to the R Project root file.
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
# Set the chunks to not print the messages and warnings
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

```{r libraries loading, echo=FALSE}
library(tidyverse)
library(DT)
```

## Introduction

This is a simple analysis of the `mtcars` dataset. The dataset contains information about 32 cars of different brands and models. The data is available from `data/mtcars/mtcars.rds`. The dataset contains the following variables:

* `mpg`: Miles/(US) gallon
* `cyl`: Number of cylinders
* `disp`: Displacement (cu.in.)
* `hp`: Gross horsepower
* `drat`: Rear axle ratio
* `wt`: Weight (1000 lbs)
* `qsec`: 1/4 mile time
* `vs`: Engine (0 = V-shaped, 1 = straight)
* `am`: Transmission (0 = automatic, 1 = manual)
* `gear`: Number of forward gears
* `carb`: Number of carburetors

### Analysis goals

The analysis goals are:

* To load the dataset and view it as a table
* To calculate the correlation of weight and miles per gallon
* To plot the relationship between weight and miles per gallon with the correlation coefficient

## Data analysis

### Data loading & viewing

We first load the data from `data/mtcars/mtcars.rds` and view it as a table.

```{r data loading, echo=FALSE}
# Load the data
mtcars <- read_rds("data/mtcars/mtcars.rds")

# Show the data using the DT package
datatable(mtcars)
```

### Correlation calculation

We calculate the correlation of weight and miles per gallon.

```{r correlation calculation}
corr <- cor.test(mtcars$wt, mtcars$mpg)
corr
```

### Plotting

We plot the relationship between weight and miles per gallon with the correlation coefficient.

```{r plotting, fig.width=8, fig.height=6}
mtcars %>%
    ggplot(aes(x = wt, y = mpg)) +
    geom_point() +
    geom_smooth(method = "lm", se = FALSE) +
    labs(
        title = "Relationship between weight and miles per gallon",
        x = "Weight (1000 lbs)",
        y = "Miles/(US) gallon",
        caption = "Source: mtcars dataset"
    ) +
    theme_minimal(base_size = 15) +
    # Add the correlation coefficient
    annotate(
        "text", x = 4.75, y = 25, 
        label = paste0("Correlation coefficient: ", round(corr$estimate, 3))
    )
```

## Conclusion

<!-- In this section, we use inline R code in order to avoid "hardcoding" our results into the markdown. If the input data changes, our results will update automatically to match. BTW -- this is an HTML comment, which are ignored in RMarkdown. -->

The correlation between weight and miles per gallon is **`r signif(corr$estimate, 4)`**. The p value of the correlation test is **`r format(signif(corr$p.value, 4))`** which is **`r ifelse(corr$p.value < 0.05, "less", "greater")`** than 0.05. Therefore, we **`r ifelse(corr$p.value < 0.05, "can", "cannot")`** reject the null hypothesis and conclude that there **`r ifelse(corr$p.value < 0.05, "is", "is not")`** a significant correlation between weight and miles per gallon.
